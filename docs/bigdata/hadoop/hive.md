# 数据仓库 - Hive

### 数据仓库

- 基本概念

`Data Warehouse`，简写为 `DW` 或 `DWH`。数据仓库的目的是构建面向分析的集成化数据环境，为企业提供决策支持（Decision Support）

数据仓库是存数据的，企业的各种数据往里面存。主要目的是为了分析有效数据，后续会基于它产出供分析挖掘的数据。

- 发展

1. 阶段1：以解决数据孤岛为需求
2. 阶段2：更好的管理和架构数据存储

数据越来越多，内容越来越庞杂。逐步发展许多数仓架构模型。eg：雪花模型、星型模型、星座模型等

基于这些模型理论，数仓中的一些行为被梳理成对应的概念。eg：维度表、事实表、指标等。

3. 阶段3：更好的数据处理流程

梳理架构之后，随着分析的进行，产生太多中间结果表、最终结果表、临时表、转换表等流程产物。提出数仓分层架构。

优点：清晰数据结构、数据血缘追踪、减少重复开发、把复杂问题简单化、屏蔽原始数据的异常

- 主要特征

1. 面向主题（Subject-Oriented）

数据仓库是面向主题的，数据仓库通过一个个主题将多个业务系统的数据加载到一起，为了各个主题（eg: 用户、订单、商品）进行分析而建，操作型数据库是为了支撑各种业务而建立。

2. 集成性（Integrated）

数据仓库会将不同源数据库中的数据汇总到一起，数据仓库中的综合数据不能从原有的数据库系统直接得到。因此在数据进行数据仓库之前，必然要经过统一与整合，这一步是数据仓库建设中最关键、最复杂的一 步 `（ETL）`，要统一源数据中所有矛盾之处，eg：字段的同名异义、异名同义、单位不统一、字长不统一等。

3. 非易失的（Non-Volatile）

操作型数据库主要服务于日常的业务操作，使得数据库需要不断的对数据实时更新，以便迅速获得当前最新数据，不至于影响正常的业务运作。

在数据仓库中只要保存过去的业务数据，不需要每一笔业务都实时更新。每隔一段时间导入更新即可。

数据仓库一般仅执行查询操作，很少会有删除和更新，但是需要定期加载和刷新数据。

4. 时变（Time-Variant）

分析结果只能反映过去的情况，当业务变化后，挖掘出的模式会失去时效性。因此数据仓库数据需要定时更新，以适应决策的需要。


### 数据库（DB）和数据仓库（DW）的区别

数据库与数据仓库的区别实际是 `OLTP` 和 `OLAP` 的区别。

- 操作型处理，叫联机事务处理OLTP（On-Line Transaction Processing），也可以称面向交易的处理系统。它是针对具体业务在数据库联机的日常操作，通常对少数记录进行查询、修改、用户较为关心`操作的响应时间`、`数据的安全性`、`完整性`和`并发`支持的用户数等问题。传统的数据库系统作为数据管理的主要手段，主要用于操作型处理。

- 分析型处理，叫联机分析处理OLAP（On-Line Analytical Processing）一般针对某些主题的历史数据进行分析，支持管理决策。

数据仓库的出现并不是要取代数据库：
1. DB面向事务的设计，DW面向主题设计
2. DB一般存储业务数据，DW一般存储历史数据
3. DB设计尽量避免冗余，符合业务应用，但不符合分析。DW有意引入冗余，依照分析需求，分析维度，分析指标进行设计
4. DB为捕获数据设计，DW为分析数据设计

**DW，是在DB已经大量存在的情况下，为了进一步挖掘数据资源，为了决策需要而产生的，绝不是所谓的“大型数据库”**


### 数仓的分层架构

依照数据流入流出的过程，数仓架构分为3层：

自上而下（ETL）

- 源数据（ODS）

此层数据无任何更改，直接沿用外围系统数据结构和数据，不对外开发，为临时存储层。是接口数据的临时存储区域，为后一步的数据处理做准备。

eg: 点击流日志（Click Stream），数据库数据（OLTP），文档数据（Documents），其他

ODS层数据来源方式：
1. 业务库：
经常会使用 `sqoop` 来抽取，定时1天。在实时方面，可以考虑用 `canel` 监听 mysql的binlog，实时接入即可。

2. 埋点日志：
线上系统会打入各种日志，这些日志一般以文件的形式保存，可以选择用 `flume` 定时抽取，也可以用 `spark streaming` 或 `Flink` 实时接入，当然， `kafka` 会是一个关键的角色。

3. 消息队列
来自 `ActiveMQ`, `Kafka` 的数据等


- 数据仓库（DW）

也成为细节层。DW层的数据应该是一致的、准确的、干净的数据、即对源系统数据进行了清洗。

eg: 聚合数据（Summary），多维数据模型（OLAP），业务模型（Business Model），细节数据（Detail Data）

- 数据应用（DA或APP）

前端应用直接读取的数据。根据报表、专题分析需求而计算生成的数据。

eg: 报表展示（Report），即席查询（Ad-hoc），数据分析（Data Analysis），数据挖掘（Data Mining）

> 数据仓库从各种数据源获取的数据及在数据仓库内的数据转化和流动都可以认为是ETL过程。ETL是数据仓库的流水线，维系数仓中数据的新陈代谢，而数仓日常的管理和维护工作的大部分精力就是保证ETL的正常和稳定。

为什么对数据仓库分层？

> 用空间换时间。拆分之后简化对数仓的管理

### 数仓的元数据管理

元数据（Meta Data），主要记录数仓中模型的定义、各层级间的映射关系、监控数据仓库的数据状态及ETL的任务运行状态。一般会通过元数据资料库（Metadata Repository）来统一存储和管理元数据，其主要目的是使数据仓库的设计、部署、操作和管理能达到协同和一致。

### Hive

- 简介

Hive是基于Hadoop的一个数据仓库工具，可以将`结构化的数据`文件映射为一张数据库表，并提供类SQL查询功能。

其本质将SQL转化为MapReduce任务进行运算，底层由HDFS提供的数据存储。

- 为什么使用Hive

1. 采用类SQL语法（HQL）去操作数据，提供快速开发能力
2. 避免去写MapReduce，减少开发人员学习成本
3. 功能扩展很方便

### Hive架构


### Hive交互方式








