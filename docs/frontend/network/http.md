# HTTP

## HTTP 0.9  `1991`

- 请求：仅有 `GET` 一种
- 返回：仅 `HTML` 文本数据

![http0.9](http://cdn.chemputer.top/notebook/network/http0.9.jpg)

::: warning 不足
- 只有请求行，没有 `请求头`，`请求体`
- 同理，服务端只是返回数据。 没有 `响应头`, `响应体`
- TCP 连接无法复用
:::


## HTTP 1.0  `1996`

- 请求端增加 HTTP 协议版本，响应端增加状态码。
- 请求：增加了 `POST` 和 `HEAD`
- 请求端和响应端增加头部字段。
    - `Content-Type` 让响应数据不只限于超文本。
    - `Expires`、`Last-Modified` 缓存头。
    - `Authorization` 身份认证。
    - `Connection`: keep-alive 支持长连接，但非标准


![http1.0](http://cdn.chemputer.top/notebook/network/http1.0.jpg)


:::warning 不足
- TCP 连接无法复用
- HTTP 队头阻塞 (一个 HTTP 请求响应结束之后，才能发起下一个 HTTP 请求)
- 一台服务器只能提供一个 HTTP 服务
:::

## HTTP 1.1  `1999`

- 默认使用长连接 `Connection: keep-alive`

- 管线化

`1.0` 只有前一次请求发出并得到响应，第二次的请求才可以发出。

`1.1` 可以同时向服务器发出多个请求。但有 `队头阻塞` 的缺陷。

:::tip 队头阻塞
虽然一次发出多个请求，但是服务端响应还是按照请求顺序响应。

很可能出现：前面某个请求的响应时间很长，后面有很多请求排队等候。

很多厂子都做过管线化实验，由于种种原因，不得放弃。
- 支持断点续传，通过请求头的 `range`  来实现
- 新增缓存标识。`E-tag`、 `if-match`、 `if-none-match`
:::

![http1.1](http://cdn.chemputer.top/notebook/network/http1.1.jpg)


:::warning 不足
- 队头阻塞
- 多次请求，请求头重复信息太多
- 请求没有优先级
- 只有客户端请求 - 服务端响应这个模式
:::


## HTTP 2.0  `2015`

`2015`年发布，针对 `1.1` 有如下改变：

- 多路复用

每一个请求都对应一个 `id`，这样请求就可以分开。每个响应也都有对应 `id`，可以打包混合运送。客户端收到之后，根据自己id，将数据组合。

请求优先级，遇到高优先级的，可以停止当前相应，去处理优先级高的请求。

- 头部压缩

同时发送多个请求，头部会帮助消除重复的部分。这就是 `HPACK` 算法。

客户端、服务端同时维护一张头信息表，所有的字段都会存入这张表，生成索引号码，每一次仅仅发送索引号码就可以。这样网络传输更快。

- 二进制格式

`2.0` 不像 `1.1` 里纯文本形式的报文，而是全面采用二进制格式。虽然对人不友好，但是对于计算机，省去转化二级制的过程，增加了数据传输的效率。

- 数据流

`2.0` 不是按照顺序发送，同一个连接里面连续的数据包，可能属于不同的回应。

客户端发送的编号是奇数、服务端发出的编号是偶数。

客户端可以指定数据流的优先级，优先级高的请求，服务端就先响应其请求。

- 服务器推送

服务端可以主动向客户端发送消息

:::warning 不足
多个 `HTTP` 请求在复用一个 `TCP` 连接，而 `TCP` 协议是不知道有多少个 `HTTP` 请求。所以一旦发生丢包现象，就会触发 `TCP` 的 `重传机制`。这样一个 `TCP` 连接中的所有请求都必须等待这个丢失的包重新传回来。
:::


## HTTP 3.0

对传输层进行了优化，使用 `QUIC` 替换 `TCP`，彻底规避了 TCP 传输的效率问题。


[参考](https://segmentfault.com/a/1190000039134645)